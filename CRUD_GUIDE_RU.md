# 📚 Полный CRUD Гайд - Библиотека

Этот документ описывает все операции CRUD (Create, Read, Update, Delete) для книг и авторов в приложении Библиотеке.

## 🚀 Быстрый Старт

### Backend запуск
```bash
cd backend
dotnet run
```
Backend запустится на `http://localhost:5148`

### Frontend запуск
```bash
cd frontend
npm install  # если нужно
npm run dev
```
Frontend откроется на `http://localhost:5173`

---

## 📖 API Endpoints

### **АВТОРЫ** (Authors)

#### 1️⃣ **CREATE - Добавить нового автора**
- **Метод:** `POST`
- **URL:** `http://localhost:5148/api/authors`
- **Тело запроса:**
```json
{
  "name": "Лев Толстой",
  "country": "Россия"
}
```
- **Ответ (201 Created):**
```json
{
  "id": 1,
  "name": "Лев Толстой",
  "country": "Россия",
  "books": []
}
```

#### 2️⃣ **READ - Получить всех авторов**
- **Метод:** `GET`
- **URL:** `http://localhost:5148/api/authors`
- **Ответ (200 OK):**
```json
[
  {
    "id": 1,
    "name": "Лев Толстой",
    "country": "Россия",
    "books": [...]
  },
  {
    "id": 2,
    "name": "Федор Достоевский",
    "country": "Россия",
    "books": [...]
  }
]
```

#### 3️⃣ **READ ONE - Получить одного автора**
- **Метод:** `GET`
- **URL:** `http://localhost:5148/api/authors/{id}`
- **Пример:** `http://localhost:5148/api/authors/1`
- **Ответ (200 OK):**
```json
{
  "id": 1,
  "name": "Лев Толстой",
  "country": "Россия",
  "books": [...]
}
```

#### 4️⃣ **UPDATE - Обновить автора**
- **Метод:** `PUT`
- **URL:** `http://localhost:5148/api/authors/{id}`
- **Пример:** `http://localhost:5148/api/authors/1`
- **Тело запроса:**
```json
{
  "id": 1,
  "name": "Лев Николаевич Толстой",
  "country": "Российская Империя"
}
```
- **Ответ (204 No Content)**

#### 5️⃣ **DELETE - Удалить автора**
- **Метод:** `DELETE`
- **URL:** `http://localhost:5148/api/authors/{id}`
- **Пример:** `http://localhost:5148/api/authors/1`
- **Ответ (204 No Content)**
- ⚠️ **Внимание:** При удалении автора удаляются все его книги!

---

### **КНИГИ** (Books)

#### 1️⃣ **CREATE - Добавить новую книгу**
- **Метод:** `POST`
- **URL:** `http://localhost:5148/api/books`
- **Тело запроса:**
```json
{
  "title": "Война и мир",
  "year": 1869,
  "authorId": 1
}
```
- **Ответ (201 Created):**
```json
{
  "id": 1,
  "title": "Война и мир",
  "year": 1869,
  "authorId": 1,
  "author": {
    "id": 1,
    "name": "Лев Толстой",
    "country": "Россия",
    "books": [...]
  }
}
```

#### 2️⃣ **READ - Получить все книги**
- **Метод:** `GET`
- **URL:** `http://localhost:5148/api/books`
- **Ответ (200 OK):**
```json
[
  {
    "id": 1,
    "title": "Война и мир",
    "year": 1869,
    "authorId": 1,
    "author": {...}
  },
  {
    "id": 2,
    "title": "Преступление и наказание",
    "year": 1866,
    "authorId": 2,
    "author": {...}
  }
]
```

#### 3️⃣ **READ ONE - Получить одну книгу**
- **Метод:** `GET`
- **URL:** `http://localhost:5148/api/books/{id}`
- **Пример:** `http://localhost:5148/api/books/1`
- **Ответ (200 OK):**
```json
{
  "id": 1,
  "title": "Война и мир",
  "year": 1869,
  "authorId": 1,
  "author": {...}
}
```

#### 4️⃣ **UPDATE - Обновить книгу**
- **Метод:** `PUT`
- **URL:** `http://localhost:5148/api/books/{id}`
- **Пример:** `http://localhost:5148/api/books/1`
- **Тело запроса:**
```json
{
  "id": 1,
  "title": "Война и мир (издание 2025)",
  "year": 1869,
  "authorId": 1
}
```
- **Ответ (204 No Content)**

#### 5️⃣ **DELETE - Удалить книгу**
- **Метод:** `DELETE`
- **URL:** `http://localhost:5148/api/books/{id}`
- **Пример:** `http://localhost:5148/api/books/1`
- **Ответ (204 No Content)**

---

## 🖥️ Web Интерфейс

### Страница АВТОРОВ
Доступна по адресу: `http://localhost:5173`

**Функции:**
- ➕ **Добавить автора** - Введите имя и страну
- 📖 **Просмотр списка** - Показывает всех авторов
- ✏️ **Редактировать** - Нажмите кнопку "Редактировать" для изменения
- 🗑️ **Удалить** - Удаляет автора и все его книги

### Страница КНИГ
Доступна по адресу: `http://localhost:5173/books`

**Функции:**
- ➕ **Добавить книгу** - Введите название, год и выберите автора
- 📚 **Просмотр списка** - Показывает все книги с авторами
- ✏️ **Редактировать** - Изменяет данные книги
- 🗑️ **Удалить** - Удаляет книгу

---

## 📝 Примеры на cURL

### Добавить автора
```bash
curl -X POST http://localhost:5148/api/authors \
  -H "Content-Type: application/json" \
  -d '{"name":"Пушкин","country":"Россия"}'
```

### Получить всех авторов
```bash
curl http://localhost:5148/api/authors
```

### Обновить автора
```bash
curl -X PUT http://localhost:5148/api/authors/1 \
  -H "Content-Type: application/json" \
  -d '{"id":1,"name":"А.С. Пушкин","country":"Россия"}'
```

### Удалить автора
```bash
curl -X DELETE http://localhost:5148/api/authors/1
```

### Добавить книгу
```bash
curl -X POST http://localhost:5148/api/books \
  -H "Content-Type: application/json" \
  -d '{"title":"Евгений Онегин","year":1833,"authorId":1}'
```

### Получить все книги
```bash
curl http://localhost:5148/api/books
```

### Обновить книгу
```bash
curl -X PUT http://localhost:5148/api/books/1 \
  -H "Content-Type: application/json" \
  -d '{"id":1,"title":"Евгений Онегин","year":1833,"authorId":1}'
```

### Удалить книгу
```bash
curl -X DELETE http://localhost:5148/api/books/1
```

---

## 📊 Структура БД

### Таблица Authors
| Поле | Тип | Описание |
|------|-----|---------|
| Id | INT | Первичный ключ |
| Name | VARCHAR(200) | Имя автора (обязательно) |
| Country | VARCHAR(100) | Страна автора (обязательно) |

### Таблица Books
| Поле | Тип | Описание |
|------|-----|---------|
| Id | INT | Первичный ключ |
| Title | VARCHAR(200) | Название книги (обязательно) |
| Year | INT | Год издания (обязательно) |
| AuthorId | INT | Внешний ключ на Authors |

**Связь:** Один автор может иметь много книг (1:N)
**Cascade Delete:** При удалении автора удаляются все его книги

---

## ✅ Статус Кодов

| Код | Значение | Описание |
|-----|----------|---------|
| 200 | OK | Успешный GET запрос |
| 201 | Created | Ресурс успешно создан |
| 204 | No Content | Успешное обновление или удаление |
| 400 | Bad Request | Ошибка в запросе (неверные данные) |
| 404 | Not Found | Ресурс не найден |
| 500 | Internal Server Error | Ошибка сервера |

---

## 🎯 Практические Примеры

### Сценарий 1: Добавить нового автора и его книги

1. **Создать автора:**
```json
POST /api/authors
{
  "name": "Иван Тургенев",
  "country": "Россия"
}
```
Получаем: `id: 3`

2. **Добавить первую книгу:**
```json
POST /api/books
{
  "title": "Отцы и дети",
  "year": 1862,
  "authorId": 3
}
```

3. **Добавить вторую книгу:**
```json
POST /api/books
{
  "title": "Рудин",
  "year": 1856,
  "authorId": 3
}
```

### Сценарий 2: Обновить информацию об авторе и его книге

1. **Обновить автора:**
```json
PUT /api/authors/3
{
  "id": 3,
  "name": "Иван Сергеевич Тургенев",
  "country": "Франция" (переехал)
}
```

2. **Обновить одну из его книг:**
```json
PUT /api/books/5
{
  "id": 5,
  "title": "Отцы и дети (переиздание)",
  "year": 1862,
  "authorId": 3
}
```

---

## 🛠️ Таблица Всех Операций

| Операция | Метод | URL | Возвращает |
|----------|-------|-----|-----------|
| Добавить автора | POST | /api/authors | Объект автора с ID |
| Получить авторов | GET | /api/authors | Массив авторов |
| Получить автора | GET | /api/authors/{id} | Объект автора |
| Обновить автора | PUT | /api/authors/{id} | No Content |
| Удалить автора | DELETE | /api/authors/{id} | No Content |
| Добавить книгу | POST | /api/books | Объект книги с ID |
| Получить книги | GET | /api/books | Массив книг |
| Получить книгу | GET | /api/books/{id} | Объект книги |
| Обновить книгу | PUT | /api/books/{id} | No Content |
| Удалить книгу | DELETE | /api/books/{id} | No Content |

---

## 📌 Важные Заметки

✅ **Полный CRUD реализован:**
- ✔️ Create (POST) - создание новых записей
- ✔️ Read (GET) - получение записей
- ✔️ Update (PUT) - обновление записей
- ✔️ Delete (DELETE) - удаление записей

✅ **Связи между сущностями:**
- Каждая книга привязана к автору через AuthorId
- При удалении автора удаляются все его книги (Cascade Delete)

✅ **Frontend интеграция:**
- Автоматическая загрузка списков авторов и книг
- Интуитивный интерфейс для всех CRUD операций
- Отображение имен авторов для каждой книги

✅ **Валидация:**
- Поля обязательны (Title, Year, AuthorId для книг; Name, Country для авторов)
- Ограничение длины строк в БД (Name/Title до 200 символов)

---

## 🆘 Решение Проблем

### Проблема: 404 Not Found при обновлении

**Причина:** ID не существует в БД

**Решение:** Проверьте ID в базе данных через GET запрос

### Проблема: 400 Bad Request

**Причина:** Неверный формат JSON или пропущены обязательные поля

**Решение:** Проверьте синтаксис JSON и убедитесь, что все поля заполнены

### Проблема: CORS ошибка

**Причина:** Frontend и Backend работают на разных портах

**Решение:** CORS уже включен в backend, ошибка должна пройти

---

Удачи с использованием API! 🎉

